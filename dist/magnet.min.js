"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var Events=function(){function t(e){_classCallCheck(this,t),this._parent=e,this._startX=0,this._startY=0,this._focus=!1,this._component=!1,this.initEvents()}return _createClass(t,[{key:"initEvents",value:function(){var t=this,n=document.getElementById(this._parent._id+"_board"),i=this;n.addEventListener("mousedown",function(e){var t=e.target.id,n="component"==e.target.getAttribute("type");i.startDrag({id:t,component:n,x:e.x,y:e.y})}),n.addEventListener("mouseup",function(e){t.stopDrag({x:e.x,y:e.y})}),n.addEventListener("mousemove",function(e){t._focus&&t.moveItem({x:e.x,y:e.y})}),n.addEventListener("mouseleave",function(e){t._focus&&t.mouseLeave()}),n.addEventListener("touchstart",function(e){var t=e.changedTouches[0].target.id,n="component"==e.changedTouches[0].target.getAttribute("type");i.startDrag({id:t,component:n,x:e.changedTouches[0].clientX,y:e.changedTouches[0].clientY})}),n.addEventListener("touchmove",function(e){t._focus&&t.moveItem({x:e.changedTouches[0].clientX,y:e.changedTouches[0].clientY})}),n.addEventListener("touchend",function(e){t.stopDrag({x:e.changedTouches[0].clientX,y:e.changedTouches[0].clientY}),n.addEventListener("touchcancel",function(e){t._focus&&t.mouseLeave()})})}},{key:"startDrag",value:function(e){var t=document.getElementById(e.id);this._offsetX=e.x,this._offsetY=e.y,this._startX=parseInt(t.style.left.split("px")[0]),this._startY=parseInt(t.style.top.split("px")[0]),this._focus=e.id,this._component=e.component}},{key:"moveItem",value:function(e){var t=document.getElementById(this._parent._id+"_board"),n=parseInt(window.getComputedStyle(t,null).getPropertyValue("left").split("px")[0]),i=parseInt(window.getComputedStyle(t,null).getPropertyValue("right").split("px")[0]),a=parseInt(window.getComputedStyle(t,null).getPropertyValue("top").split("px")[0]),r=parseInt(window.getComputedStyle(t,null).getPropertyValue("bottom").split("px")[0]),o=this._lastX-e.x,s=this._lastY-e.y;((n<this._parent.View._width/2||0<o)&&i<this._parent.View._width/2||o<0||this._component)&&(document.getElementById(this._focus).style.left=this._startX+(e.x-this._offsetX)),((a<this._parent.View._width/2||0<s)&&r<this._parent.View._width/2||s<0||this._component)&&(document.getElementById(this._focus).style.top=this._startY+(e.y-this._offsetY)),this._component||(parseInt(window.getComputedStyle(t,null).getPropertyValue("left").split("px")[0])>this._parent.View._width/2&&(document.getElementById(this._focus).style.left=this._parent.View._width/2),parseInt(window.getComputedStyle(t,null).getPropertyValue("top").split("px")[0])>this._parent.View._height/2&&(document.getElementById(this._focus).style.top=this._parent.View._height/2),parseInt(window.getComputedStyle(t,null).getPropertyValue("right").split("px")[0])>this._parent.View._width/2&&(document.getElementById(this._focus).style.left=-this._parent.View._width/2+this._parent.View._wrapperX),parseInt(window.getComputedStyle(t,null).getPropertyValue("bottom").split("px")[0])>this._parent.View._height/2&&(document.getElementById(this._focus).style.top=-this._parent.View._height/2+this._parent.View._wrapperY)),this._lastX=e.x,this._lastY=e.y}},{key:"stopDrag",value:function(e){var t=this._startX+(e.x-this._offsetX),n=this._startY+(e.y-this._offsetY),i=this._parent.View.convertXY(t,n,"component");if(this._component)this._parent.View.getItem(this._focus).setLocalPosition(i.x,i.y);else{document.getElementById(this._focus).style.left.split("px")[0],document.getElementById(this._focus).style.top.split("px")[0];var a=this._parent.View.getPosition();window.location.hash=a.x+","+a.y}this._focus=!1}},{key:"mouseLeave",value:function(){document.getElementById(this._focus).style.left=this._startX,document.getElementById(this._focus).style.top=this._startY,this._focus=!1}}]),t}();exports.default=Events,Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}(),_index=require("./component/index.js"),_index2=_interopRequireDefault(_index),_View=require("./View.js"),_View2=_interopRequireDefault(_View),_Theme=require("./Theme.js"),_Theme2=_interopRequireDefault(_Theme),_Events=require("./Events.js"),_Events2=_interopRequireDefault(_Events),_Socket=require("./Socket.js"),_Socket2=_interopRequireDefault(_Socket),_Mixins=require("./Mixins.js"),_Mixins2=_interopRequireDefault(_Mixins);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var Magnet=function(){function i(e){var t=e.target,n=e.id;_classCallCheck(this,i),this.initConfig(t,n),this.initClasses()}return _createClass(i,[{key:"initConfig",value:function(e,t){this._root=e,this._id=t,this._name="",this._description=""}},{key:"initClasses",value:function(){this.Mixins=new _Mixins2.default(this),this.component=_index2.default,this.View=new _View2.default(this),this.Socket=new _Socket2.default(this),this.Events=new _Events2.default(this)}},{key:"getRoot",value:function(){return document.getElementById(this._root)}},{key:"getBoard",value:function(e){this.Socket._socket.emit("load")}},{key:"setBoard",value:function(e){this.setTheme(e.theme),this.setDetails(e.board),this.setItems(e.items),this.View.fadeIn(),this.View.fadeInStats()}},{key:"setTheme",value:function(e){this.Theme=new _Theme2.default(e,this),this.View.setTheme()}},{key:"setDetails",value:function(e){this._name=e.name,this._description=e.desc,this.View.setSize(e.width,e.height),this.View.setPosition(window.location.hash.split(",")[0].split("#")[1]||0,window.location.hash.split(",")[1]||0)}},{key:"setItems",value:function(e){var t=!0,n=!1,i=void 0;try{for(var a,r=e[Symbol.iterator]();!(t=(a=r.next()).done);t=!0){var o=a.value;this.View.setItem(o.id,new this.component[o.type](o,this))}}catch(e){n=!0,i=e}finally{try{!t&&r.return&&r.return()}finally{if(n)throw i}}this.View.renderItems()}}]),i}();exports.default=Magnet,Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var Mixins=function(){function Mixins(){_classCallCheck(this,Mixins)}return _createClass(Mixins,[{key:"applyStyle",value:function(e,t,n){var i=void 0!==t.length?t:Object.entries(t),a=!0,r=!1,o=void 0;try{for(var s,l=i[Symbol.iterator]();!(a=(s=l.next()).done);a=!0)t=s.value,e.style[t[0]]=this.applyTemplate(t[1],n)}catch(e){r=!0,o=e}finally{try{!a&&l.return&&l.return()}finally{if(r)throw o}}return e}},{key:"applyTemplate",value:function applyTemplate(value,params){if(-1!=value.indexOf("[")&&(value=value.replace(/\[r\]/g,params.r).replace(/\[g\]/g,params.g).replace(/\[b\]/g,params.b)),-1!=value.indexOf("{")){var regex=value.match(/\{([^}]+)\}/g),_iteratorNormalCompletion2=!0,_didIteratorError2=!1,_iteratorError2=void 0;try{for(var _iterator2=regex[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=!0){var match=_step2.value;value=value.replace(match,eval(match))}}catch(e){_didIteratorError2=!0,_iteratorError2=e}finally{try{!_iteratorNormalCompletion2&&_iterator2.return&&_iterator2.return()}finally{if(_didIteratorError2)throw _iteratorError2}}}return value}},{key:"convertToCSSString",value:function(e){var t=Object.entries(e),n=[];console.log(e);var i=!0,a=!1,r=void 0;try{for(var o,s=t[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){for(var l=o.value,c=0;c<l[0].length;c++)l[0].charAt(c)===l[0].charAt(c).toUpperCase()&&(l[0]=l[0].slice(0,c)+"-"+l[0].slice(c,l[0].length).toLowerCase());n.push(l[0]+": "+l[1])}}catch(e){a=!0,r=e}finally{try{!i&&s.return&&s.return()}finally{if(a)throw r}}return n.join("; ")}}]),Mixins}();exports.default=Mixins,Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var Socket=function(){function t(e){_classCallCheck(this,t),this._parent=e,this.initSocket()}return _createClass(t,[{key:"initSocket",value:function(){var t=this;this._socketConnected=!1,this._socket=io.connect(),this._socket.on("connect",function(){t.onSocketConnected()}),this._socket.on("disconnect",function(){t.onSocketDisconnected()}),this._socket.on("error",function(e){t.onSocketError(e)}),this._socket.on("authenticate",function(e){t.onAuthenticate(e)}),this._socket.on("load",function(e){t.onLoad(e)}),this._socket.on("move",function(e){t.onMove(e)}),this._socket.on("add",function(e){t.onAdd(e)}),this._socket.on("noExist",function(e){t._parent.View.askCreate()}),this._socket.on("stats",function(e){t._parent.View.updateStats(e)})}},{key:"onAuthenticate",value:function(e){this._parent.getBoard(e)}},{key:"onLoad",value:function(e){this._parent.setBoard(e)}},{key:"onMove",value:function(e){var t=!0,n=!1,i=void 0;try{for(var a,r=e[Symbol.iterator]();!(t=(a=r.next()).done);t=!0){var o=a.value;o.time?this._parent.View.getItem(o.id).setRemotePosition(o.x,o.y,o.time):this._parent.View.getItem(o.id).setRemotePosition(o.x,o.y)}}catch(e){n=!0,i=e}finally{try{!t&&r.return&&r.return()}finally{if(n)throw i}}}},{key:"onAdd",value:function(e){this._parent.View.addItem(e)}},{key:"onSocketConnected",value:function(){this._socketConnected=!0,console.log(this._parent._id.split("#")[0]+": Connected to socket"),this.authenticate()}},{key:"authenticate",value:function(){console.log("authenticating"),this._socket.emit("authenticate",{id:this._parent._id})}},{key:"onSocketDisconnected",value:function(){this._socketConnected=!1,console.log(this._parent._id+": Socket disconnected")}},{key:"onSocketError",value:function(e){this._socketConnected=!1,console.log(error)}}]),t}();exports.default=Socket,Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var Theme=function(){function n(e,t){_classCallCheck(this,n),this._parent=t,this._items=new Map,this._colors=new Map,this.setTheme(e)}return _createClass(n,[{key:"setTheme",value:function(e){var n=this,t=function(t){switch(t.key){case"rgb":n._colors.set("color"==t.code?t.id:t.code,{r:t.value.split(",")[0],g:t.value.split(",")[1],b:t.value.split(",")[2]});break;default:n._items.has(t.code)||n._items.set(t.code,e.filter(function(e){return e.code==t.code}).map(function(e){return[e.key,e.value]}))}},i=!0,a=!1,r=void 0;try{for(var o,s=e[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){t(o.value)}}catch(e){a=!0,r=e}finally{try{!i&&s.return&&s.return()}finally{if(a)throw r}}}},{key:"applyTheme",value:function(e,t,n){return this._items.has(t)?this._parent.Mixins.applyStyle(e,this.getItem(t),n):e}},{key:"applyBackground",value:function(e){return e.style.background=this.getColorCSS("background"),e}},{key:"getItem",value:function(e){return this._items.get(e)}},{key:"getColor",value:function(e){return this._colors.get(e)}},{key:"getColorCSS",value:function(e){var t=this._colors.get(e);return"rgb("+t.r+","+t.g+","+t.b+")"}}]),n}();exports.default=Theme,Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}();function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var View=function(){function t(e){_classCallCheck(this,t),this._parent=e,this._items=new Map,this._classNames=new Set,this.initCSS(),this.buildDOM(),this.setWrapperSize(),this.setEvents()}return _createClass(t,[{key:"initCSS",value:function(){this._wrapperCSS={width:"100%",height:"100%",overflow:"hidden"},this._boardCSS={width:"100%",height:"100%",position:"absolute",background:"white"}}},{key:"buildDOM",value:function(){var e=document.getElementById(this._parent._root),t=document.createElement("div");t.id=this._parent._id+"_wrapper",t.className="wrapper",this._parent.Mixins.applyStyle(t,this._boardCSS);var n=document.createElement("div");n.id=this._parent._id+"_board",this._parent.Mixins.applyStyle(n,this._boardCSS);var i=document.createElement("div");i.id="members",i.className="statsToggle";var a=document.createElement("div"),r=document.createElement("div"),o=document.createElement("div");a.className="spinner",a.id="spinner",r.className="dot1",o.className="dot2",a.appendChild(r),a.appendChild(o),t.appendChild(n),e.appendChild(t),e.appendChild(i),e.appendChild(a)}},{key:"addItem",value:function(e){console.log("adding item"),this.setItem(e.id,new this._parent.component[e.type](e,this._parent)),this.renderItems()}},{key:"askCreate",value:function(){var e=this,t=this,n=document.createElement("div");n.className="message",n.innerHTML='\n    Fridge "'+this._parent._id+'" is available!<br>\n    ';var i=document.createElement("button");i.innerHTML="Create",n.id="message",i.addEventListener("click",function(){console.log("clicked",document.getElementsByClassName("message")),document.getElementsByClassName("message").outerHTML="",document.getElementById(e._parent._id+"_board").removeChild(document.getElementById("message")),t._parent.Socket._socket.emit("start",{id:t._parent._id})}),n.appendChild(i),document.getElementById(this._parent._id+"_board").appendChild(n),this.fadeIn()}},{key:"setEvents",value:function(){var t=this;window.onresize=function(e){t.setWrapperSize(),t.loadPosition()}}},{key:"setSize",value:function(e,t){this._width=e,this._height=t;var n=document.getElementById(this._parent._id+"_board");n.style.width=this._width+"px",n.style.height=this._height+"px",n.style.margin="-"+this._height/2+"px -"+this._width/2+"px"}},{key:"setPosition",value:function(e,t){this._x=e,this._y=t,this.loadPosition()}},{key:"getPosition",value:function(){var e=document.getElementById(this._parent._id+"_board");return{x:Math.floor(parseInt(e.style.left.split("px")[0])-this._wrapperX/2),y:Math.floor(parseInt(e.style.top.split("px")[0])-this._wrapperY/2)}}},{key:"setWrapperSize",value:function(){var e=document.getElementById(this._parent._id+"_wrapper");this._wrapperX=e.clientWidth,this._wrapperY=e.clientHeight}},{key:"loadPosition",value:function(){var e=document.getElementById(this._parent._id+"_board");e.style.top=parseInt(this._wrapperY/2)+parseInt(this._y)+"px",e.style.left=parseInt(this._wrapperX/2)+parseInt(this._x)+"px"}},{key:"setTheme",value:function(){this._parent.Theme.applyBackground(document.getElementById(this._parent._id+"_board"))}},{key:"setItem",value:function(e,t){this._items.set(e,t)}},{key:"getItem",value:function(e){return this._items.get(parseInt(e))}},{key:"convertXY",value:function(e,t,n){if("board"==n){var i=document.getElementById(this._parent._id+"_board");return{x:e+parseInt(i.style.width.split("px")[0])/2,y:t+parseInt(i.style.height.split("px")[0])/2}}var a=document.getElementById(this._parent._id+"_board");return{x:e-parseInt(a.style.width.split("px")[0])/2,y:t-parseInt(a.style.height.split("px")[0])/2}}},{key:"updateStats",value:function(e){document.getElementById("members").innerHTML=e.members+" Online"}},{key:"hideLoad",value:function(){document.getElementById("spinner").style.display="none"}},{key:"fadeIn",value:function(){document.getElementsByClassName("wrapper")[0].style.opacity=1}},{key:"fadeInStats",value:function(){document.getElementsByClassName("statsToggle")[0].style.opacity=1}},{key:"renderItems",value:function(){this.hideLoad();for(var e=[].concat(_toConsumableArray(this._items.values())),t=0;t<e.length;t++){var n=e[t];if(!document.getElementById(n.getItem().id)){var i=document.getElementById(this._parent._id+"_board"),a=n.getItem();i.appendChild(a)}}}},{key:"addCSSClass",value:function(e,t){var n=document.createElement("style");n.type="text/css",n.innerHTML="."+e+" { "+this._parent.Mixins.convertToCSSString(t)+" }",document.getElementsByTagName("head")[0].appendChild(n),this._classNames.add(e)}},{key:"hasClass",value:function(e){return this._classNames.has(e)}}]),t}();exports.default=View;